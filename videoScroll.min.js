"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var videoScroll=/*#__PURE__*/function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:500,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,a),this.videos=[],this.PLAYBACK=b,this.SCROLL_EASE=.05,this.VELOCITY=c,this.scrollRequest=0,this.requestId=null}return _createClass(a,[{key:"addVideo",value:function addVideo(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,f=document.createElement("div");f.classList.add("video"),""!==c&&f.classList.add(c),f.innerHTML="\n            <video style=\"position: absolute; top: 0; left: 0;\" preload=\"auto\" plays-inline=\"\" muted=\"muted\">\n                <source src=\"".concat(a,"\" type=\"video/mp4\">\n            </video>\n        "),f.style.cssText="\n            position: fixed;\n            top: 0;\n        ";var g=document.createElement("div");g.classList.add("video-container"),g.append(f),g.style.cssText="\n            position: relative;\n        ",this.videos.push({html:g,video:g.querySelector("video"),loaded:!1,visible:!1,locationId:b,offsetTop:null,offsetBottom:null,videoDuration:null,scrollY:0,scrollerY:0,times:[],pos:[],playback:d||this.PLAYBACK,velocity:e||this.VELOCITY})}},{key:"init",value:function init(){var a=this;this.videos.forEach(function(b){var c=document.querySelector("#"+b.locationId)||document.querySelector("body");c.append(b.html),b.video.load(),b.video.addEventListener("canplaythrough",function(){b.loaded=!0},{once:!0}),b.video.addEventListener("loadedmetadata",function(){b.videoDuration=b.video.duration,b.html.style="height: ".concat(b.video.duration*(b.playback+b.velocity),"px"),b.html.querySelector(".video").style.height="".concat(b.video.getBoundingClientRect().height,"px"),b.offsetTop=b.html.getBoundingClientRect().top+window.pageYOffset,b.offsetBottom=b.html.getBoundingClientRect().bottom+window.pageYOffset}.bind(a),{once:!0})})}},{key:"render",value:function render(){window.addEventListener("scroll",function(){this.scrollRequest++,this.requestId||(this.requestId=requestAnimationFrame(this.scrolling.bind(this)))}.bind(this))}},{key:"scrolling",value:function scrolling(){this.videos.forEach(function(a){var b=Math.abs;a.offsetTop=a.html.getBoundingClientRect().top+window.pageYOffset,a.offsetBottom=a.html.getBoundingClientRect().bottom+window.pageYOffset,a.visible=window.pageYOffset<=a.offsetBottom&&window.pageYOffset+window.outerHeight>=a.offsetTop,a.visible&&(a.scrollY=(window.pageYOffset-a.offsetTop)/a.playback,a.scrollerY+=(a.scrollY-a.scrollerY)*this.SCROLL_EASE,b(a.scrollY-a.scrollerY)<this.SCROLL_EASE&&(a.scrollerY=a.scrollY,this.scrollRequest=0,this.pos=[],this.times=[]),0>a.scrollerY&&(a.scrollerY=0),a.video.currentTime!==a.scrollerY&&(a.video.currentTime=a.scrollerY))}.bind(this)),this.requestId=0<this.scrollRequest?requestAnimationFrame(this.scrolling.bind(this)):null}}]),a}();
